
@use_macros
import Core::CLib;

namespace tests {

@test(expect = 5)
unsafe func strlen() i32 {
    let x = CLib::c_string::strlen(@c_str("hello"));
    return x;
}

@test(expect = 0)
unsafe func strlen_empty() i32 {
    let x = CLib::c_string::strlen(@c_str(""));
    return x;
}

@test(expect = 0)
unsafe func malloc() i32 {
    let x = CLib::malloc(20) as *const CLib::c_char;
    CLib::c_string::strcpy(x, @c_str("hello"));
    return CLib::c_string::strcmp(x, @c_str("hello"));
}

@test(expect = 0)
unsafe func realloc() i32 {
    let mut x = CLib::malloc(20) as *const CLib::c_char;
    CLib::c_string::strcpy(x, @c_str("hello"));
    x = CLib::realloc(x, 30) as *const CLib::c_char;
    CLib::c_string::strcat(x, @c_str(" world"));
    return CLib::c_string::strcmp(x, @c_str("hello world"));
}

}
